---
title: q2491. Divide Players Into Teams of Equal Skill / 將玩家分組以達到相等技能總和
note_type: knowledge
domain: leetcode
tags: [leetcode, knowledge]
created: 2026-02-03
updated: 2026-02-08
status: active
source: leetcode
complexity_time: O(n log n)
complexity_space: O(1)
review_interval_days: 14
next_review: 2026-02-22
canonical: leetcode/q2491.md
---
# q2491. Divide Players Into Teams of Equal Skill / 將玩家分組以達到相等技能總和

[2491. Divide Players Into Teams of Equal Skill](https://leetcode.com/problems/divide-players-into-teams-of-equal-skill/)

Medium

You are given a positive integer array `skill` of **even** length `n` where `skill[i]` denotes the skill of the `ith` player. Divide the players into `n / 2` teams of size `2` such that the total skill of each team is **equal**.
給定一個長度為**偶數** `n` 的正整數陣列 `skill`，其中 `skill[i]` 表示第 `i` 個玩家的技能值。將玩家分成 `n / 2` 組，每組 `2` 人，使得每組的技能總和**相等**。

The **chemistry** of a team is equal to the **product** of the skills of the players on that team.
一組的**化學值**等於該組兩個玩家技能值的**乘積**。

Return _the sum of the **chemistry** of all the teams_, or return `-1` _if there is no way to divide the players into teams such that the total skill of each team is equal_.
回傳所有組別的**化學值**總和，若無法將玩家分成技能總和相等的組別，則回傳 `-1`。

**Example 1:**

**Input:** skill = [3,2,5,1,3,4]
**Output:** 22
**Explanation:** Divide the players into the following teams: (1, 5), (2, 4), (3, 3), where each team has a total skill of 6.
The sum of the chemistry of all the teams is: 1 × 5 + 2 × 4 + 3 × 3 = 5 + 8 + 9 = 22.
**輸入：** skill = [3,2,5,1,3,4]
**輸出：** 22
**說明：** 將玩家分成以下組別：(1, 5)、(2, 4)、(3, 3)，每組技能總和為 6。
所有組別的化學值總和為：1 × 5 + 2 × 4 + 3 × 3 = 5 + 8 + 9 = 22。

**Example 2:**

**Input:** skill = [3,4]
**Output:** 12
**Explanation:** The two players form a team with a total skill of 7.
The chemistry of the team is 3 × 4 = 12.
**輸入：** skill = [3,4]
**輸出：** 12
**說明：** 兩個玩家組成一組，技能總和為 7。
該組的化學值為 3 × 4 = 12。

**Example 3:**

**Input:** skill = [1,1,2,3]
**Output:** -1
**Explanation:** There is no way to divide the players into teams such that the total skill of each team is equal.
**輸入：** skill = [1,1,2,3]
**輸出：** -1
**說明：** 無法將玩家分成技能總和相等的組別。

**Constraints:**

- `2 <= skill.length <= 10^5`
- `skill.length` is even / `skill.length` 為偶數
- `1 <= skill[i] <= 1000`

## 解題筆記與程式碼

通用演算法筆記：[sorting_custom_order](../algorithm/sorting_custom_order.md), [two_pointers](../algorithm/two_pointers.md)
資料結構筆記：[array](../data_structure/array.md)

### 思路拆解

- 若所有組別技能總和需相等，則每組總和必為 `total_sum / (n/2) = 2 * total_sum / n`。
- 若總和無法平均分配，直接回傳 `-1`。
- 排序後用雙指標：最小值與最大值配對，次小與次大配對，以此類推。
- 若任一配對的和不等於目標和，則回傳 `-1`；否則累加所有配對的乘積。

### 演算法

1. 計算總和 `total`，若 `total` 無法被 `n/2` 整除，回傳 `-1`。
2. 計算目標和 `target = 2 * total / n`。
3. 將 `skill` 排序。
4. 用雙指標 `l = 0` 和 `r = n - 1`：
   - 若 `skill[l] + skill[r] != target`，回傳 `-1`。
   - 否則累加 `skill[l] * skill[r]` 到結果。
   - `l++`, `r--`。
5. 回傳累計的化學值總和。

### 時間與空間

- 時間：`O(n log n)`，排序為主要成本。
- 空間：`O(1)`，不計排序所需空間。

```rust
impl Solution {
    pub fn divide_players(mut skill: Vec<i32>) -> i64 {
        let n = skill.len();
        let total: i32 = skill.iter().sum();

        // Check if total can be evenly divided
        if total % (n as i32 / 2) != 0 {
            return -1;
        }

        let target = total / (n as i32 / 2);
        skill.sort_unstable();

        let mut chemistry = 0i64;
        let mut l = 0;
        let mut r = n - 1;

        while l < r {
            let sum = skill[l] + skill[r];
            if sum != target {
                return -1;
            }
            chemistry += skill[l] as i64 * skill[r] as i64;
            l += 1;
            r -= 1;
        }

        chemistry
    }
}
```

## 補充筆記

### 核心觀察

- 排序後的配對策略（最小配最大）保證若解存在，此法必能找到。
- 若存在有效分組，所有組的和必須相同，因此可先驗證總和的可分性。
- 時間複雜度由排序決定，雙指標遍歷為線性。

Sources:
- [LeetCode 2491](https://leetcode.com/problems/divide-players-into-teams-of-equal-skill/)
- [GitHub doocs/leetcode solution](https://github.com/doocs/leetcode/blob/main/solution/2400-2499/2491.Divide%20Players%20Into%20Teams%20of%20Equal%20Skill/README_EN.md)
