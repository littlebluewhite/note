---
title: "q2110"
category: leetcode
tags: [leetcode]
created: 2026-02-03
updated: 2026-02-03
difficulty: Medium
source: leetcode
status: active
complexity_time: O(n)
complexity_space: O(1)
---
[2110. Number of Smooth Descent Periods of a Stock](https://leetcode.com/problems/number-of-smooth-descent-periods-of-a-stock/)

Medium

Topics

![premium lock icon](https://leetcode.com/_next/static/images/lock-a6627e2c7fa0ce8bc117c109fb4e567d.svg)Companies

Hint

You are given an integer array `prices` representing the daily price history of a stock, where `prices[i]` is the stock price on the `ith` day.
給定整數陣列 `prices` 表示某支股票每日價格，`prices[i]` 為第 `i` 天的股價。

A **smooth descent period** of a stock consists of **one or more contiguous** days such that the price on each day is **lower** than the price on the **preceding day** by **exactly** `1`. The first day of the period is exempted from this rule.
一段股票的「平滑下降區間」由一或多天組成，從第二天開始，每天的價格都必須比前一天**正好低 1**，第一天不受此限制。

Return _the number of **smooth descent periods**_.
請回傳所有「平滑下降區間」的數量。

**Example 1:**

**Input:** prices = [3,2,1,4]  
**Output:** 7  
**Explanation:** There are 7 smooth descent periods:  
[3], [2], [1], [4], [3,2], [2,1], and [3,2,1]  
Note that a period with one day is a smooth descent period by the definition.  
**輸出說明：** 共有 7 段平滑下降區間，如上列表。單日區間也算合法。

**Example 2:**

**Input:** prices = [8,6,7,7]  
**Output:** 4  
**Explanation:** There are 4 smooth descent periods: [8], [6], [7], and [7]  
Note that [8,6] is not a smooth descent period as 8 - 6 ≠ 1.  
**輸出說明：** 合法區間只有 [8]、[6]、[7]、[7]；[8,6] 不符合因為差值不是 1。

**Example 3:**

**Input:** prices = [1]  
**Output:** 1  
**Explanation:** There is 1 smooth descent period: [1]  
**輸出說明：** 單一天構成唯一的合法區間。

**Constraints:**

- `1 <= prices.length <= 10^5`
- `1 <= prices[i] <= 10^5`
- `1 <= prices.length <= 10^5`。
- `1 <= prices[i] <= 10^5`。
---
## 解題筆記與程式碼

DP 筆記：[dp_dynamic_programming](../algorithm/dp_dynamic_programming.md)

### 核心想法

- 連續「每天 -1」的區段長度為 `len` 時，該段的合法子區間數為 `len * (len + 1) / 2`。單趟掃描維護當前連續長度 `run`，每走一步把 `run` 加進答案，等價於累計所有以當前日為結尾的合法區間。
- 若前一天與今天差值為 1（即今天價格 = 昨天 - 1），`run += 1`；否則重置為 1。答案用 `i64` 防溢位。

### 時間與空間

- 時間：`O(n)`
- 空間：`O(1)`

Where:
`n`: length of `prices`.


### Rust

```rust
impl Solution {
    pub fn get_descent_periods(prices: Vec<i32>) -> i64 {
        let mut run: i64 = 0;
        let mut ans: i64 = 0;

        for i in 0..prices.len() {
            if i > 0 && prices[i - 1] - prices[i] == 1 {
                run += 1;
            } else {
                run = 1;
            }
            ans += run;
        }

        ans
    }
}
```


## 補充筆記：`run` 從 1 開始，答案至少為 1。
- 相等或差值不為 -1 時，需重置 `run = 1`（當天單點區間）。
- 可能超過 32 位，使用 64 位累加。