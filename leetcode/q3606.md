[3606. Coupon Code Validator](https://leetcode.com/problems/coupon-code-validator/)

Easy

Topics

![premium lock icon](https://leetcode.com/_next/static/images/lock-a6627e2c7fa0ce8bc117c109fb4e567d.svg)Companies

Hint

You are given three arrays of length `n` that describe the properties of `n` coupons: `code`, `businessLine`, and `isActive`. The `ith` coupon has:
給定三個長度為 `n` 的陣列 `code`、`businessLine` 與 `isActive`，描述 `n` 張優惠券的屬性；第 `i` 張優惠券有：

- `code[i]`: a **string** representing the coupon identifier.
- `code[i]`：代表優惠券代碼的字串。
- `businessLine[i]`: a **string** denoting the business category of the coupon.
- `businessLine[i]`：優惠券所屬業務類別的字串。
- `isActive[i]`: a **boolean** indicating whether the coupon is currently active.
- `isActive[i]`：優惠券目前是否啟用的布林值。

A coupon is considered **valid** if all of the following conditions hold:
若同時滿足以下條件，優惠券被視為「有效」：

1. `code[i]` is non-empty and consists only of alphanumeric characters (a-z, A-Z, 0-9) and underscores (`_`).
2. `businessLine[i]` is one of the following four categories: `"electronics"`, `"grocery"`, `"pharmacy"`, `"restaurant"`.
3. `isActive[i]` is **true**.
1. `code[i]` 不為空，且只包含英數字元與底線 `_`。
2. `businessLine[i]` 必須是 `"electronics"`、`"grocery"`、`"pharmacy"`、`"restaurant"` 其中之一。
3. `isActive[i]` 為 **true**。

Return an array of the **codes** of all valid coupons, **sorted** first by their **businessLine** in the order: `"electronics"`, `"grocery"`, `"pharmacy", "restaurant"`, and then by **code** in lexicographical (ascending) order within each category.
請回傳所有有效優惠券的「代碼」陣列，排序優先依上述業務類別順序，再在同一類別內按代碼字典序遞增排序。

**Example 1:**

**Input:** code = ["SAVE20","","PHARMA5","SAVE@20"], businessLine = ["restaurant","grocery","pharmacy","restaurant"], isActive = [true,true,true,true]

**Output:** ["PHARMA5","SAVE20"]

**Explanation:**

- First coupon is valid.
- Second coupon has empty code (invalid).
- Third coupon is valid.
- Fourth coupon has special character `@` (invalid).
- 第一張優惠券有效。
- 第二張代碼為空，無效。
- 第三張優惠券有效。
- 第四張包含特殊字元 `@`，無效。

**Example 2:**

**Input:** code = ["GROCERY15","ELECTRONICS_50","DISCOUNT10"], businessLine = ["grocery","electronics","invalid"], isActive = [false,true,true]

**Output:** ["ELECTRONICS_50"]

**Explanation:**

- First coupon is inactive (invalid).
- Second coupon is valid.
- Third coupon has invalid business line (invalid).
- 第一張未啟用，無效。
- 第二張有效。
- 第三張業務類別不合法，無效。

**Constraints:**

- `n == code.length == businessLine.length == isActive.length`
- `1 <= n <= 100`
- `0 <= code[i].length, businessLine[i].length <= 100`
- `code[i]` and `businessLine[i]` consist of printable ASCII characters.
- `isActive[i]` is either `true` or `false`.
- `n == code.length == businessLine.length == isActive.length`。
- `1 <= n <= 100`。
- `0 <= code[i].length, businessLine[i].length <= 100`。
- `code[i]` 和 `businessLine[i]` 由可列印 ASCII 字元組成。
- `isActive[i]` 為 `true` 或 `false`。

## 解題筆記與程式碼

通用演算法筆記：[sorting_custom_order](../algorithm/sorting_custom_order.md)
資料結構筆記：[hash_map_set](../data_structure/hash_map_set.md)

### 核心觀察

- 條件僅為三項獨立檢查：是否啟用、代碼字元是否合法、業務類別是否在白名單中；逐一掃描即可完成篩選。
- 先將允許的業務類別映射成順序索引，後續排序只需比較 `(order, code)` 的 tuple，即可同時滿足類別優先與代碼字典序。
- 代碼合法性使用 `is_ascii_alphanumeric` 或底線檢查，避免額外正規表示式依賴。

### 演算法

1. 建立白名單映射 `HashMap<&str, usize>`：`electronics, grocery, pharmacy, restaurant` 對應順序 0..3。
2. 同時遍歷三個輸入陣列：若未啟用、代碼為空、代碼含非法字元、或業務類別不在映射中則略過，否則收集 `(order, code)`。
3. 對收集到的 pair 排序，最後取出代碼欄位作為答案。

### 時間與空間

- 時間：O(n log n)，排序為主要成本。
- 空間：O(n)，存放通過檢查的 `(order, code)`。

```rust
use std::collections::HashMap;

impl Solution {
    pub fn validate_coupons(code: Vec<String>, business_line: Vec<String>, is_active: Vec<bool>) -> Vec<String> {
        let allowed = ["electronics", "grocery", "pharmacy", "restaurant"];
        let mut order: HashMap<&str, usize> = HashMap::new();
        for (idx, cat) in allowed.iter().enumerate() {
            order.insert(cat, idx);
        }

        let mut valid: Vec<(usize, String)> = Vec::new();

        for ((c, b), active) in code.into_iter().zip(business_line.into_iter()).zip(is_active.into_iter()) {
            if !active {
                continue;
            }
            if c.is_empty() {
                continue;
            }
            if !c.chars().all(|ch| ch.is_ascii_alphanumeric() || ch == '_') {
                continue;
            }
            if let Some(&idx) = order.get(b.as_str()) {
                valid.push((idx, c));
            }
        }

        valid.sort_by(|a, b| a.cmp(b));
        valid.into_iter().map(|(_, code)| code).collect()
    }
}
```


## 補充筆記：O(n) 儲存通過篩選的配對；映射與常數狀態為 O(1)。

## 邊界注意

- 空字串直接判定無效；`is_ascii_alphanumeric` 僅涵蓋英數，不接受空白或特殊符號。
- 分類字串長度最高 100，但只需檢查是否存在於映射表，無需額外處理。
