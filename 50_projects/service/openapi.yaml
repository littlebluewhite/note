openapi: 3.0.3
info:
  title: Ecommerce API
  version: 0.1.0
servers:
  - url: http://localhost:3000
tags:
  - name: Auth
  - name: Catalog
  - name: Cart
  - name: Checkout
  - name: Orders
  - name: Payments
  - name: Shipping
  - name: Admin
paths:
  /auth/login:
    post:
      tags: [Auth]
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout
      security:
        - bearerAuth: []
      responses:
        '204':
          description: No Content
  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
  /products:
    get:
      tags: [Catalog]
      summary: List products
      parameters:
        - in: query
          name: q
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
  /products/{id}:
    get:
      tags: [Catalog]
      summary: Get product
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
  /categories:
    get:
      tags: [Catalog]
      summary: List categories
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
  /cart:
    get:
      tags: [Cart]
      summary: Get cart
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
  /cart/items:
    post:
      tags: [Cart]
      summary: Add item to cart
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartItemCreate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
  /cart/items/{id}:
    patch:
      tags: [Cart]
      summary: Update cart item
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartItemUpdate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
    delete:
      tags: [Cart]
      summary: Remove cart item
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
  /checkout:
    post:
      tags: [Checkout]
      summary: Checkout and create payment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckoutRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckoutResponse'
  /orders:
    get:
      tags: [Orders]
      summary: List orders
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
  /orders/{id}:
    get:
      tags: [Orders]
      summary: Get order
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
  /orders/{id}/cancel:
    post:
      tags: [Orders]
      summary: Cancel order
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
  /orders/{id}/refunds:
    get:
      tags: [Orders]
      summary: List refunds for order
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Refund'
    post:
      tags: [Orders]
      summary: Request refund
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefundRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Refund'
  /payments/ecpay/notify:
    post:
      tags: [Payments]
      summary: ECPay callback
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
      responses:
        '200':
          description: OK
  /admin/orders/{id}/shipments:
    post:
      tags: [Shipping]
      summary: Create shipment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShipmentCreate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Shipment'
  /admin/shipments/{id}:
    patch:
      tags: [Shipping]
      summary: Update shipment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShipmentUpdate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Shipment'
  /admin/products:
    get:
      tags: [Admin]
      summary: List products (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
    post:
      tags: [Admin]
      summary: Create product
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Created
  /admin/products/{id}:
    get:
      tags: [Admin]
      summary: Get product (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
    put:
      tags: [Admin]
      summary: Update product
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
    delete:
      tags: [Admin]
      summary: Delete product
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
  /admin/orders:
    get:
      tags: [Admin]
      summary: List orders (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
  /admin/orders/{id}:
    get:
      tags: [Admin]
      summary: Get order (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
    patch:
      tags: [Admin]
      summary: Update order (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
  /admin/coupons:
    get:
      tags: [Admin]
      summary: List coupons
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
    post:
      tags: [Admin]
      summary: Create coupon
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Created
  /admin/coupons/{id}:
    get:
      tags: [Admin]
      summary: Get coupon
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
    put:
      tags: [Admin]
      summary: Update coupon
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
    delete:
      tags: [Admin]
      summary: Delete coupon
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
    RefreshRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string
    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
    Product:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        status:
          type: string
        variants:
          type: array
          items:
            $ref: '#/components/schemas/ProductVariant'
    ProductVariant:
      type: object
      properties:
        id:
          type: string
        sku:
          type: string
        price:
          type: integer
    Category:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        parent_id:
          type: string
    Cart:
      type: object
      properties:
        id:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/CartItem'
    CartItem:
      type: object
      properties:
        id:
          type: string
        variant_id:
          type: string
        qty:
          type: integer
        price_snapshot:
          type: integer
    CartItemCreate:
      type: object
      required: [variant_id, qty]
      properties:
        variant_id:
          type: string
        qty:
          type: integer
    CartItemUpdate:
      type: object
      properties:
        qty:
          type: integer
    CheckoutRequest:
      type: object
      required: [address]
      properties:
        address:
          $ref: '#/components/schemas/Address'
        coupon_code:
          type: string
    CheckoutResponse:
      type: object
      properties:
        order_id:
          type: string
        payment_url:
          type: string
    Address:
      type: object
      required: [name, phone, address1, city, postal_code]
      properties:
        name:
          type: string
        phone:
          type: string
        address1:
          type: string
        address2:
          type: string
        city:
          type: string
        postal_code:
          type: string
    Order:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
        total:
          type: integer
        currency:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
    OrderItem:
      type: object
      properties:
        id:
          type: string
        variant_id:
          type: string
        qty:
          type: integer
        price_snapshot:
          type: integer
    RefundRequest:
      type: object
      required: [amount, reason]
      properties:
        amount:
          type: integer
        reason:
          type: string
    Refund:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
        amount:
          type: integer
        reason:
          type: string
    ShipmentCreate:
      type: object
      required: [carrier, tracking_no]
      properties:
        carrier:
          type: string
        tracking_no:
          type: string
    ShipmentUpdate:
      type: object
      properties:
        status:
          type: string
        tracking_no:
          type: string
    Shipment:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
        carrier:
          type: string
        tracking_no:
          type: string
